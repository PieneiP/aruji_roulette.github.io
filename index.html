<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>ğ’œğ“‡ğ“Šğ’¿ğ’¾ â„›â„´ğ“Šğ“â„¯ğ“‰ğ“‰â„¯</title>
<style>
  body{ font-family:sans-serif; display:flex; flex-direction:column; align-items:center; padding:20px; }
  #grid{ display:grid; grid-template-columns:repeat(3,200px); gap:30px; margin-bottom:12px; }
  .cell{ width:200px; height:80px; display:flex; align-items:center; justify-content:center;
    border:1px solid #999; font-size:36px; user-select:none; border-radius:6px; }
  #message{ margin-top:8px; font-size:18px; color:#d33; min-height:24px; }
  button{ margin:6px; padding:8px 14px; }
  .gaming{
	border: unset;
	outline: unset;
	border-radius: 99999px;
	padding-top: 10px;
	padding-bottom: 10px;
	padding-left: 20px;
	padding-right: 20px;
	font-size: 20px;
	position: relative;
	background-color: #000;
	color: #fff;
	font-weight: bold;
	transition: 250ms;
  }
  .gaming::after{
	content: "";
	position: absolute;
	left: -5px;
	top: -5px;
	z-index: -1;
	width: 100%;
	height: 100%;
	padding: 5px;
	background-color: transparent;
	border-radius: 99999px;
	animation: gaming 2000ms linear infinite;
  background: linear-gradient(to right, Magenta, Yellow, Cyan, Magenta) 0% center/200%;
  }
  @keyframes gaming{
    100%{
      background-position-x: 200%;
    }
  }
</style>
</head>
<body>

<h2>ğ’œğ“‡ğ“Šğ’¿ğ’¾ â„›â„´ğ“Šğ“â„¯ğ“‰ğ“‰â„¯</h2>

<div id="grid" aria-live="polite"></div>

<div>
  <button id="startBtn" class="gaming">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ï¼ï¼</button>
  <button id="resetBtn" class="gaming">ãƒªã‚»ãƒƒãƒˆ</button>
  <button id="copyBtn" class="gaming">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
</div>

<div id="message" role="status" aria-atomic="true"></div>

<script>
const letters = [":emoji_104:",":gakiruji:",":emoji_103:",":summeruji:",":aruji:"];
const grid = document.getElementById("grid");
const messageEl = document.getElementById("message");
const startBtn = document.getElementById("startBtn");
const resetBtn = document.getElementById("resetBtn");
const copyBtn = document.getElementById("copyBtn");

let cells = [];
let intervalIds = [];
let stopTimeouts = [];
let running = false;

const lines = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

function pick(){ return letters[Math.floor(Math.random()*letters.length)]; }

function initGrid(){
  clearAllTimers();

  grid.innerHTML = "";
  cells = [];
  intervalIds = new Array(9).fill(null);
  stopTimeouts = new Array(9).fill(null);

  for(let i=0;i<9;i++){
    const div = document.createElement("div");
    div.className = "cell";
    div.textContent = pick();
    grid.appendChild(div);
    cells.push(div);
  }
  messageEl.textContent = "";
  running = false;
  startBtn.disabled = false;
  resetBtn.disabled = false;
}

function clearAllTimers(){
  intervalIds.forEach(id => id && clearInterval(id));
  stopTimeouts.forEach(id => id && clearTimeout(id));
  running = false;
}

function checkWin(){
  for(const [a,b,c] of lines){
    const va = cells[a].textContent;
    if(va && va === cells[b].textContent && va === cells[c].textContent){
      return va;
    }
  }
  return null;
}

function start(){
  if(running) return;
  running = true;
  startBtn.disabled = true;
  resetBtn.disabled = true;
  messageEl.textContent = "";

  let remaining = cells.length;

  for(let i=0;i<cells.length;i++){
    const speed = 50 + Math.random()*150;

    intervalIds[i] = setInterval(()=>{
      cells[i].textContent = pick();
    }, Math.round(speed));

    const stopDelay = 800 + Math.random()*1500;

    stopTimeouts[i] = setTimeout(()=>{
      clearInterval(intervalIds[i]);
      intervalIds[i] = null;

      remaining--;
      if(remaining === 0){
        const win = checkWin();
        if(win){
          messageEl.textContent = `ã€Œ${win}ã€ãŒ3ã¤æƒã„ã¾ã—ãŸï¼`;
        }else{
          messageEl.textContent = "ã‚‹ã˜ã‚’ãŠã—ã¦ã‚‚ã²ã¨ã‚Š";
        }
        running = false;
        startBtn.disabled = false;
        resetBtn.disabled = false;
      }
    }, Math.round(stopDelay));
  }
}

function reset(){
  clearAllTimers();
  initGrid();
}

startBtn.addEventListener("click", start);
resetBtn.addEventListener("click", reset);

// â–¼â–¼ ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½è¿½åŠ  â–¼â–¼
copyBtn.addEventListener("click", () => {
  // 3Ã—3 ã‚’ãƒ†ã‚­ã‚¹ãƒˆåŒ–
  const rows = [];
  for(let r=0; r<3; r++){
    rows.push(
      cells.slice(r*3, r*3+3).map(c => c.textContent).join(" ")
    );
  }
  let text = rows.join("\n");

  if(messageEl.textContent.trim()){
    text += "\n\n" + messageEl.textContent.trim();
  }

  navigator.clipboard.writeText(text)
    .then(() => {
      alert("ã‚‹ã˜ã‚’ãã‚ãˆã¦ã‚‚ã‚‹ã˜");
    })
    .catch(err => {
      alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: " + err);
    });
});
// â–²â–² ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã“ã“ã¾ã§ â–²â–²

initGrid();
</script>

</body>
</html>

